<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Importing Data and Computing Differences in fundsr • fundsr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Importing Data and Computing Differences in fundsr">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fundsr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/importing-and-computing-differences.html">Importing Data and Computing Differences in fundsr</a></li>
    <li><a class="dropdown-item" href="../articles/simple-demo-using-real-data.html">Simple Demo Using Real Data</a></li>
    <li><a class="dropdown-item" href="../articles/survival-curves-for-financial-planning.html">Survival Curves for Financial Planning</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/StanTraykov/fundsr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="importing-and-computing-differences_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><script src="importing-and-computing-differences_files/viz-1.8.2/viz.js"></script><link href="importing-and-computing-differences_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="importing-and-computing-differences_files/grViz-binding-1.0.11/grViz.js"></script><script src="importing-and-computing-differences_files/kePrint-0.0.1/kePrint.js"></script><link href="importing-and-computing-differences_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Importing Data and Computing Differences in fundsr</h1>
                        <h4 data-toc-skip class="author">Stanislav
Traykov</h4>
            
            <h4 data-toc-skip class="date">2026-01-12</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/StanTraykov/fundsr/blob/main/vignettes/importing-and-computing-differences.Rmd" class="external-link"><code>vignettes/importing-and-computing-differences.Rmd</code></a></small>
      <div class="d-none name"><code>importing-and-computing-differences.Rmd</code></div>
    </div>

    
    
<style>
.figure p.caption, .figcaption, .table caption {
    color: #646464;
    font-size: 0.92em;
    margin-bottom: 1.2em;
}

.teaser-figure {
    margin-top: 0;
    margin-bottom: 1.6em;
    margin-left: auto;
    margin-right: auto;
    text-align: center;
}
</style>
<style>
.figure p.caption {
    margin-top: 0.92ex;
}
</style>
<div class="teaser-figure">
<div class="float">
<img src="figures/example-plot.png" alt="A glimpse of the final result"><div class="figcaption">A glimpse of the final result</div>
</div>
</div>
<p>This vignette shows how to load data into fundsr and compute rolling
differences (CAGR and log) using the example files shipped with the
package. For a demonstration based on NAV histories downloaded from fund
providers—which also covers liquidity plots and translation support—see
<a href="https://stantraykov.github.io/fundsr/articles/simple-demo-using-real-data.html">Simple
Demo Using Real Data</a>. Guidance on obtaining real NAVs and index
levels lives in the <a href="https://github.com/StanTraykov/fundsr/wiki" class="external-link">project wiki</a>.</p>
<p>More complex workflows are provided (without data) under
<code>scripts/examples</code> in the package directory; start with
<code>glob_funds.R</code> or <code>all_funds.R</code>. The directory can
be located with
<code>system.file("scripts/examples", package = "fundsr")</code>.</p>
<div class="section level2">
<h2 id="the-master-table">The master table<a class="anchor" aria-label="anchor" href="#the-master-table"></a>
</h2>
<p>fundsr’s core workflow (Figure 1) consists of reading daily fund NAVs
and index levels from files and building a master series table.
Plottable tracking differences are computed from this table via
<code><a href="../reference/roll_diffs.html">roll_diffs()</a></code>.</p>
<div class="figure">
<div id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:100%;height:192px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"diagram":"\n  digraph {\n    graph [rankdir = LR]\n    node [shape=box, style=rounded, color=blue];\n    \"load data from files\" -> \"build master table\" -> \"calculate diffs\" -> \"plot\";\n  }\n  ","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script><p class="caption">
Figure 1: Rolling differences workflow
</p>
</div>
<p>The master table has a date column named <code>date</code> and one
column per series (either fund NAVs or net/gross index levels; see Table
1 for an example). Fund NAV columns use lowercase names by convention
(e.g. <code>spyy</code>). Index level columns are typically uppercase
(e.g. <code>ACWI</code>, <code>GMLM</code>, <code>SP500</code>) or
mixed-case with an initial uppercase letter (e.g. <code>WxUSA</code>).
Net total return levels are stored under a shortened index name, while
gross total return levels are identified by a <code>-GR</code> suffix
(e.g. <code>ACWI-GR</code>, <code>SP500-GR</code>).</p>
<p><strong>Note:</strong> The lowercase naming is useful because fund
identifiers (typically tickers) may coincide with index names
(e.g. Amundi’s ACWI). The <code>-GR</code> suffix is the default value
of the <code>gross_suffix</code> parameter in <code><a href="../reference/roll_diffs.html">roll_diffs()</a></code>,
which is used to switch between net and gross calculations.</p>
<p><strong>IMPORTANT:</strong> Only NAV histories of accumulating funds
are valid inputs, as these are equivalent to total return series. fundsr
does <strong>not</strong> support total return calculation for
distributing ETFs and using it with such NAVs will produce garbage. (I
am not aware of a free source of comprehensive distribution histories
for UCITS ETFs that would allow reconstruction of total return.)</p>
<table class="table table table-striped table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Table 1: A master series table (illustrative example; values rounded)
</caption>
<thead><tr>
<th style="text-align:left;">
date
</th>
<th style="text-align:right;">
iusq
</th>
<th style="text-align:right;">
spyi
</th>
<th style="text-align:right;">
spyy
</th>
<th style="text-align:right;">
webn
</th>
<th style="text-align:right;">
scwx
</th>
<th style="text-align:right;">
ACWI
</th>
<th style="text-align:right;">
ACWI-GR
</th>
<th style="text-align:right;">
GMLM
</th>
<th style="text-align:right;">
GMLM-GR
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
2025-10-14
</td>
<td style="text-align:right;">
104.5
</td>
<td style="text-align:right;">
279.6
</td>
<td style="text-align:right;">
277.5
</td>
<td style="text-align:right;">
12.57
</td>
<td style="text-align:right;">
11.67
</td>
<td style="text-align:right;">
536.7
</td>
<td style="text-align:right;">
2307
</td>
<td style="text-align:right;">
2467
</td>
<td style="text-align:right;">
2569
</td>
</tr>
<tr>
<td style="text-align:left;">
2025-10-15
</td>
<td style="text-align:right;">
105.2
</td>
<td style="text-align:right;">
281.7
</td>
<td style="text-align:right;">
279.5
</td>
<td style="text-align:right;">
12.67
</td>
<td style="text-align:right;">
11.75
</td>
<td style="text-align:right;">
540.6
</td>
<td style="text-align:right;">
2324
</td>
<td style="text-align:right;">
2485
</td>
<td style="text-align:right;">
2588
</td>
</tr>
<tr>
<td style="text-align:left;">
2025-10-16
</td>
<td style="text-align:right;">
105.1
</td>
<td style="text-align:right;">
281.4
</td>
<td style="text-align:right;">
279.3
</td>
<td style="text-align:right;">
12.66
</td>
<td style="text-align:right;">
11.74
</td>
<td style="text-align:right;">
540.0
</td>
<td style="text-align:right;">
2321
</td>
<td style="text-align:right;">
2483
</td>
<td style="text-align:right;">
2586
</td>
</tr>
<tr>
<td style="text-align:left;">
2025-10-17
</td>
<td style="text-align:right;">
105.1
</td>
<td style="text-align:right;">
281.1
</td>
<td style="text-align:right;">
279.2
</td>
<td style="text-align:right;">
12.65
</td>
<td style="text-align:right;">
11.73
</td>
<td style="text-align:right;">
539.8
</td>
<td style="text-align:right;">
2320
</td>
<td style="text-align:right;">
2481
</td>
<td style="text-align:right;">
2584
</td>
</tr>
<tr>
<td style="text-align:left;">
2025-10-20
</td>
<td style="text-align:right;">
106.3
</td>
<td style="text-align:right;">
284.5
</td>
<td style="text-align:right;">
282.5
</td>
<td style="text-align:right;">
12.80
</td>
<td style="text-align:right;">
11.87
</td>
<td style="text-align:right;">
546.3
</td>
<td style="text-align:right;">
2348
</td>
<td style="text-align:right;">
2511
</td>
<td style="text-align:right;">
2615
</td>
</tr>
<tr>
<td style="text-align:left;">
2025-10-21
</td>
<td style="text-align:right;">
106.2
</td>
<td style="text-align:right;">
284.3
</td>
<td style="text-align:right;">
282.3
</td>
<td style="text-align:right;">
12.79
</td>
<td style="text-align:right;">
11.86
</td>
<td style="text-align:right;">
545.8
</td>
<td style="text-align:right;">
2346
</td>
<td style="text-align:right;">
2508
</td>
<td style="text-align:right;">
2613
</td>
</tr>
<tr>
<td style="text-align:left;">
2025-10-22
</td>
<td style="text-align:right;">
105.8
</td>
<td style="text-align:right;">
283.1
</td>
<td style="text-align:right;">
281.2
</td>
<td style="text-align:right;">
12.74
</td>
<td style="text-align:right;">
11.82
</td>
<td style="text-align:right;">
543.6
</td>
<td style="text-align:right;">
2337
</td>
<td style="text-align:right;">
2499
</td>
<td style="text-align:right;">
2603
</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org" class="external-link">lubridate</a></span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stantraykov.github.io/fundsr/">fundsr</a></span><span class="op">)</span></span></code></pre></div>
<p><code><a href="../reference/fundsr_options.html">fundsr_options()</a></code> can be used to set (and sanity-check)
package options.</p>
<p>fundsr reads fund NAVs and index levels from a single directory
specified via the <code>fundsr.data_dir</code> option. The following
code sets it to the <code>extdata</code> directory shipped with the
package. The plot output directory is set to <code>output</code> (option
<code>fundsr.out_dir</code>).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/fundsr_options.html">fundsr_options</a></span><span class="op">(</span></span>
<span>    data_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, package <span class="op">=</span> <span class="st">"fundsr"</span><span class="op">)</span>,</span>
<span>    out_dir <span class="op">=</span> <span class="st">"output"</span>, <span class="co"># where to store plots</span></span>
<span>    export_svg <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># output SVG (main workflow)</span></span>
<span>    </span>
<span>    px_width <span class="op">=</span> <span class="fl">1300</span>, <span class="co"># for optional PNG output</span></span>
<span>    <span class="co"># internal_png = TRUE, # output PNG using ggplot2</span></span>
<span></span>
<span>    <span class="co"># Need to set path only if auto-detection fails    </span></span>
<span>    <span class="co"># inkscape = "path/to" # optional PNG output via Inkscape</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>Note:</strong> In normal use, fundsr may also write to the
data directory, if <code><a href="../reference/download_fund_data.html">download_fund_data()</a></code> is used.</p>
</div>
<div class="section level2">
<h2 id="importing">Importing<a class="anchor" aria-label="anchor" href="#importing"></a>
</h2>
<p>Importing usually involves reading fund NAVs and index levels from
Excel, CSV, or TSV files into data frames and storing them in fundsr’s
cached storage environment, from which the master table is constructed
(typically via a single call to <code><a href="../reference/build_all_series.html">build_all_series()</a></code>). A
fund→index map, required for tracking-difference calculations, is
maintained and updated as new series are added.</p>
<p>The example files in Table 2 (shipped with the package in
<code>extdata</code>) are used to demonstrate the importing
functions.</p>
<table class="table table table-striped table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Table 2: Example input files
</caption>
<thead><tr>
<th style="text-align:left;">
File
</th>
<th style="text-align:left;">
Type
</th>
<th style="text-align:left;">
Description
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
FNDA.xlsx
</td>
<td style="text-align:left;">
Excel
</td>
<td style="text-align:left;">
NAVs for fund FNDA tracking IDX1
</td>
</tr>
<tr>
<td style="text-align:left;">
FNDB.xlsx
</td>
<td style="text-align:left;">
Excel
</td>
<td style="text-align:left;">
FNDB tracking IDX1, fund launched 2024-03-16
</td>
</tr>
<tr>
<td style="text-align:left;">
GNDA.xlsx
</td>
<td style="text-align:left;">
Excel
</td>
<td style="text-align:left;">
NAVs for fund GNDA tracking IDX2
</td>
</tr>
<tr>
<td style="text-align:left;">
GNDB.csv
</td>
<td style="text-align:left;">
CSV
</td>
<td style="text-align:left;">
NAVs for fund GNDB tracking IDX2
</td>
</tr>
<tr>
<td style="text-align:left;">
IDX1.xlsx
</td>
<td style="text-align:left;">
Excel
</td>
<td style="text-align:left;">
index levels for IDX1, net and gross
</td>
</tr>
<tr>
<td style="text-align:left;">
IDX2G.csv
</td>
<td style="text-align:left;">
CSV
</td>
<td style="text-align:left;">
index levels for IDX2, gross return
</td>
</tr>
<tr>
<td style="text-align:left;">
IDX2N.csv
</td>
<td style="text-align:left;">
CSV
</td>
<td style="text-align:left;">
index levels for IDX2, net return
</td>
</tr>
</tbody>
</table>
<div class="section level3">
<h3 id="store_timeseries">
<code>store_timeseries()</code><a class="anchor" aria-label="anchor" href="#store_timeseries"></a>
</h3>
<p><code><a href="../reference/store_timeseries.html">store_timeseries()</a></code> is the basic function for importing
into the storage environment. It is most commonly used via wrappers such
as <code><a href="../reference/load_fund.html">load_fund()</a></code> or the vendor-specific wrappers around
<code><a href="../reference/load_fund.html">load_fund()</a></code>—handling Excel NAV histories from Amundi, HSBC,
Invesco, iShares, SPDR, UBS, Vanguard, and Xtrackers. It is often called
directly when importing CSV/TSV files or data frames.</p>
<p>The example fund GNDB has a NAV history in CSV format with dates
expressed as milliseconds since the Unix epoch, a NAV column, and a
Benchmark column that will not be imported from the fund file in this
example.</p>
<pre><code>Date,NAV,Benchmark
1704067200000,100,100
1704153600000,101.595595,101.588368
1704240000000,100.510764,100.494977</code></pre>
<p>GNDB’s NAV data can be loaded into fundsr’s storage environment by
reading it as a <code>tibble</code> via <code><a href="../reference/read_timeseries.html">read_timeseries()</a></code>.
<code><a href="../reference/read_timeseries.html">read_timeseries()</a></code> recognizes the date format, parses the
dates, and renames the date column to <code>date</code>, as required for
the master table. The <code>NAV</code> column from the CSV file has to
be renamed separately to a lowercase fund identifier for the master
table. The <code><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select()</a></code> in the middle of the pipeline ensures
the extraneous <code>Benchmark</code> column is not included (we will
import the benchmark later from its own file).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/store_timeseries.html">store_timeseries</a></span><span class="op">(</span></span>
<span>    var_name <span class="op">=</span> <span class="st">"gndb"</span>,</span>
<span>    expr <span class="op">=</span> <span class="fu"><a href="../reference/read_timeseries.html">read_timeseries</a></span><span class="op">(</span><span class="st">"GNDB.csv"</span>, date_col <span class="op">=</span> <span class="st">"Date"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">date</span>, <span class="va">NAV</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>gndb <span class="op">=</span> <span class="va">NAV</span><span class="op">)</span>,</span>
<span>    fund_index_map <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>gndb <span class="op">=</span> <span class="st">"IDX2"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The variable name used for the storage environment
(<code>var_name</code>) can be chosen arbitrarily and serves as the
cache key. The <code>fund_index_map</code> parameter defines a mapping
from fund identifier to its corresponding index identifier.</p>
<p><strong>Note:</strong> To make use of caching, the expression
supplied via the <code>expr</code> parameter should <strong>not</strong>
contain a ready-made tibble or similar, constructed outside of the call.
It should contain a function call or pipeline that performs the
potentially costly operations, like loading from Excel, the Internet,
etc. If <code>var_name</code> is already present in fundsr’s storage
environment, the expression will <strong>not</strong> be evaluated at
the time of the <code><a href="../reference/store_timeseries.html">store_timeseries()</a></code> call, unless a reload is
being requested or the <code>overwrite</code> parameter to
<code><a href="../reference/store_timeseries.html">store_timeseries()</a></code> is <code>TRUE</code>. (See <a href="#using-data-loaders">Using data loaders</a> and <a href="#resetting-and-reloading">Resetting and reloading</a>.)</p>
<p>When loading gross indices, the convention is to map them to the net
index in the fund_index_map
(e.g. <code>SP500-GR</code>→<code>SP500</code>). This allows gross
indices to be plotted against net indices. When plotted against the net
index, the gross index serves a reference equivalent to an ETF with
perfect tracking, no withholding taxes, and no ongoing fees.</p>
<p>The following code block uses <code><a href="../reference/store_timeseries.html">store_timeseries()</a></code> to load
the <code>IDX1</code> and <code>IDX2</code> indices, tracked by the
example funds. <code><a href="../reference/read_timeseries_excel.html">read_timeseries_excel()</a></code> flexibly reads Excel
files and accepts a <code>col_trans</code> argument to translate Excel
columns (matched using regular expressions) to imported columns.
<code>IDX2</code> is imported into a single variable (<code>idx2</code>)
by joining the net and gross time series (via
<code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">dplyr::full_join()</a></code>). The columns in
<code>IDX2{N,G}.csv</code> are already appropriately named for the
master table. Importing the files into separate variables via two calls
to <code><a href="../reference/store_timeseries.html">store_timeseries()</a></code> would lead to the same master
table.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/store_timeseries.html">store_timeseries</a></span><span class="op">(</span></span>
<span>    var_name <span class="op">=</span> <span class="st">"idx1"</span>,</span>
<span>    expr <span class="op">=</span> <span class="fu"><a href="../reference/read_timeseries_excel.html">read_timeseries_excel</a></span><span class="op">(</span></span>
<span>        file <span class="op">=</span> <span class="st">"IDX1.xlsx"</span>,</span>
<span>        sheet <span class="op">=</span> <span class="fl">1</span>,</span>
<span>        date_col <span class="op">=</span> <span class="st">"^Date"</span>,</span>
<span>        col_trans <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"IDX1"</span>    <span class="op">=</span> <span class="st">"^Index One Net"</span>,</span>
<span>                      <span class="st">"IDX1-GR"</span> <span class="op">=</span> <span class="st">"^Index One Gross"</span><span class="op">)</span>,</span>
<span>        date_order <span class="op">=</span> <span class="st">"dmy"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    fund_index_map <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>`IDX1-GR` <span class="op">=</span> <span class="st">"IDX1"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading Excel: '/tmp/RtmpNHTwCB/temp_libpath1d696685a5d/fundsr/extdata/IDX1.xlsx'</span></span>
<span></span>
<span><span class="fu"><a href="../reference/store_timeseries.html">store_timeseries</a></span><span class="op">(</span></span>
<span>    var_name <span class="op">=</span> <span class="st">"idx2"</span>,</span>
<span>    expr <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">full_join</a></span><span class="op">(</span><span class="fu"><a href="../reference/read_timeseries.html">read_timeseries</a></span><span class="op">(</span><span class="st">"IDX2N.csv"</span><span class="op">)</span>,</span>
<span>                     <span class="fu"><a href="../reference/read_timeseries.html">read_timeseries</a></span><span class="op">(</span><span class="st">"IDX2G.csv"</span><span class="op">)</span>,</span>
<span>                     by <span class="op">=</span> <span class="st">"date"</span><span class="op">)</span>,</span>
<span>    fund_index_map <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>`IDX2-GR` <span class="op">=</span> <span class="st">"IDX2"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="load_fund">
<code>load_fund()</code><a class="anchor" aria-label="anchor" href="#load_fund"></a>
</h3>
<p><code><a href="../reference/load_fund.html">load_fund()</a></code> reads an Excel file with fund NAVs into the
storage environment (it calls <code><a href="../reference/store_timeseries.html">store_timeseries()</a></code> with an
expression that uses <code><a href="../reference/read_timeseries_excel.html">read_timeseries_excel()</a></code>). It accepts
<strong>regular expressions</strong> for identifying the date and NAV
columns and a <code>sheet</code> (name or number) selecting the
worksheet within the Excel workbook that contains the NAV history. The
default values are <code>date_col = "^Date"</code>,
<code>nav_col = "^NAV"</code>, and <code>sheet = 1</code> (which works
for single-sheet workbooks). The first argument (usually a fund ticker),
converted to lowercase, is used as the variable name for
<code><a href="../reference/store_timeseries.html">store_timeseries()</a></code> and as the tibble column name that will
eventually propagate to the master table. The <code>benchmark</code>
argument provides the fund→index mapping.</p>
<div class="figure" style="text-align: left">
<img src="figures/excel-example.png" class="r-plt" alt="Figure 2: Excel file for FNDA"><p class="caption">
Figure 2: Excel file for FNDA
</p>
</div>
<p>The NAV history for FNDA is provided in an Excel workbook with
multiple sheets and a date column named “As Of” (Figure 2). If the
defaults for <code>sheet</code>, <code>date_col</code>, or
<code>nav_col</code> do not match the file layout, you
<strong>must</strong> specify the relevant parameters. They will be used
to reliably locate the NAV and date ranges even when the sheet contains
extraneous rows and columns around the data (common in fund-manager
files). For this file, <code>sheet</code> and <code>date_col</code> are
required; <code>nav_col</code> is optional because the default would
still match.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/load_fund.html">load_fund</a></span><span class="op">(</span><span class="st">"FNDA"</span>,</span>
<span>          <span class="st">"FNDA.xlsx"</span>,</span>
<span>          benchmark <span class="op">=</span> <span class="st">"IDX1"</span>,</span>
<span>          sheet <span class="op">=</span> <span class="st">"historical"</span>,</span>
<span>          date_col <span class="op">=</span> <span class="st">"^As Of"</span>,</span>
<span>          nav_col <span class="op">=</span> <span class="st">"^NAV"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading Excel: '/tmp/RtmpNHTwCB/temp_libpath1d696685a5d/fundsr/extdata/FNDA.xlsx'</span></span></code></pre></div>
<p><code><a href="../reference/load_fund.html">load_fund()</a></code> recognizes proper Excel dates, improperly
stored Excel dates, and a large number of text date formats used in fund
files, but the date order (e.g. <code>"dmy"</code>, <code>"mdy"</code>,
<code>"ymd"</code>) must be known for interpretation of text dates. It
defaults to <code>"dmy"</code> which is the most common in UCITS ETF NAV
histories.</p>
<p>FNDB has text dates in MM/DD/YYYY format, so supplying
<code>date_order = "mdy"</code> is required.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/load_fund.html">load_fund</a></span><span class="op">(</span><span class="st">"FNDB"</span>,</span>
<span>          <span class="st">"FNDB.xlsx"</span>,</span>
<span>          benchmark <span class="op">=</span> <span class="st">"IDX1"</span>,</span>
<span>          date_col <span class="op">=</span> <span class="st">"^date"</span>,</span>
<span>          nav_col <span class="op">=</span> <span class="st">"^net asset val"</span>,</span>
<span>          date_order <span class="op">=</span> <span class="st">"mdy"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading Excel: '/tmp/RtmpNHTwCB/temp_libpath1d696685a5d/fundsr/extdata/FNDB.xlsx'</span></span></code></pre></div>
<p>The final fund to load is GNDA.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/load_fund.html">load_fund</a></span><span class="op">(</span><span class="st">"GNDA"</span>,</span>
<span>          <span class="st">"GNDA.xlsx"</span>,</span>
<span>          benchmark <span class="op">=</span> <span class="st">"IDX2"</span>,</span>
<span>          date_col <span class="op">=</span> <span class="st">"^Date"</span>,</span>
<span>          nav_col <span class="op">=</span> <span class="st">"^Official NAV"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading Excel: '/tmp/RtmpNHTwCB/temp_libpath1d696685a5d/fundsr/extdata/GNDA.xlsx'</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="building-the-master-table">Building the master table<a class="anchor" aria-label="anchor" href="#building-the-master-table"></a>
</h3>
<p>First, verify that all funds and indices from the previous sections
have been loaded into the storage environment, and that columns follow
the naming convention: lowercase for funds and uppercase (or initial
uppercase) for indices.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_storage.html">get_storage</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "fnda" "fndb" "gnda" "gndb" "idx1" "idx2"</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">v</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_head</a></span><span class="op">(</span><span class="va">s</span><span class="op">[[</span><span class="va">v</span><span class="op">]</span><span class="op">]</span>, n <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt;         date     fnda</span></span>
<span><span class="co">#&gt; 1 2024-01-01 100.0000</span></span>
<span><span class="co">#&gt; 2 2024-01-02 101.4624</span></span>
<span><span class="co">#&gt;         date     fndb</span></span>
<span><span class="co">#&gt; 1 2024-03-16 106.2136</span></span>
<span><span class="co">#&gt; 2 2024-03-17 104.2975</span></span>
<span><span class="co">#&gt;         date     gnda</span></span>
<span><span class="co">#&gt; 1 2024-01-01 100.0000</span></span>
<span><span class="co">#&gt; 2 2024-01-02 101.5749</span></span>
<span><span class="co">#&gt;         date     gndb</span></span>
<span><span class="co">#&gt; 1 2024-01-01 100.0000</span></span>
<span><span class="co">#&gt; 2 2024-01-02 101.5956</span></span>
<span><span class="co">#&gt;         date     IDX1  IDX1-GR</span></span>
<span><span class="co">#&gt; 1 2024-01-01 100.0000 100.0000</span></span>
<span><span class="co">#&gt; 2 2024-01-02 101.4753 101.4767</span></span>
<span><span class="co">#&gt;         date     IDX2 IDX2-GR</span></span>
<span><span class="co">#&gt; 1 2024-01-01 100.0000  100.00</span></span>
<span><span class="co">#&gt; 2 2024-01-02 101.5884  101.59</span></span></code></pre></div>
<p><code><a href="../reference/build_all_series.html">build_all_series()</a></code> joins all tibbles (or other types of
data frames) in the storage environment into a single tibble—the master
series table.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">master_series</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_all_series.html">build_all_series</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><code>master_series</code> should now be a tibble resembling Table 3.
The <code>fndb</code> column contains <code>NA</code> values in the
initial rows due to FNDB launching in 2024-03-16 (the first NAV date in
its Excel file).</p>
<table class="table table table-striped table-condensed table-responsive" style="margin-left: auto; margin-right: auto;">
<caption>
Table 3: Resulting series table (excerpt)
</caption>
<thead><tr>
<th style="text-align:left;">
date
</th>
<th style="text-align:right;">
fnda
</th>
<th style="text-align:right;">
fndb
</th>
<th style="text-align:right;">
gnda
</th>
<th style="text-align:right;">
gndb
</th>
<th style="text-align:right;">
IDX1
</th>
<th style="text-align:right;">
IDX1-GR
</th>
<th style="text-align:right;">
IDX2
</th>
<th style="text-align:right;">
IDX2-GR
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
2024-01-01
</td>
<td style="text-align:right;">
100.000
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
100.000
</td>
<td style="text-align:right;">
100.000
</td>
<td style="text-align:right;">
100.000
</td>
<td style="text-align:right;">
100.000
</td>
<td style="text-align:right;">
100.000
</td>
<td style="text-align:right;">
100.000
</td>
</tr>
<tr>
<td style="text-align:left;">
2024-01-02
</td>
<td style="text-align:right;">
101.462
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
101.575
</td>
<td style="text-align:right;">
101.596
</td>
<td style="text-align:right;">
101.475
</td>
<td style="text-align:right;">
101.477
</td>
<td style="text-align:right;">
101.588
</td>
<td style="text-align:right;">
101.590
</td>
</tr>
<tr>
<td style="text-align:left;">
2024-01-03
</td>
<td style="text-align:right;">
100.395
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
100.487
</td>
<td style="text-align:right;">
100.511
</td>
<td style="text-align:right;">
100.390
</td>
<td style="text-align:right;">
100.392
</td>
<td style="text-align:right;">
100.495
</td>
<td style="text-align:right;">
100.498
</td>
</tr>
<tr>
<td style="text-align:left;">
2024-01-04
</td>
<td style="text-align:right;">
100.740
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
100.622
</td>
<td style="text-align:right;">
100.619
</td>
<td style="text-align:right;">
100.736
</td>
<td style="text-align:right;">
100.740
</td>
<td style="text-align:right;">
100.613
</td>
<td style="text-align:right;">
100.618
</td>
</tr>
<tr>
<td style="text-align:left;">
2024-01-05
</td>
<td style="text-align:right;">
99.156
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
99.112
</td>
<td style="text-align:right;">
99.089
</td>
<td style="text-align:right;">
99.166
</td>
<td style="text-align:right;">
99.172
</td>
<td style="text-align:right;">
99.104
</td>
<td style="text-align:right;">
99.111
</td>
</tr>
<tr>
<td style="text-align:left;">
2024-01-06
</td>
<td style="text-align:right;">
100.029
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:right;">
100.140
</td>
<td style="text-align:right;">
100.126
</td>
<td style="text-align:right;">
100.051
</td>
<td style="text-align:right;">
100.058
</td>
<td style="text-align:right;">
100.156
</td>
<td style="text-align:right;">
100.164
</td>
</tr>
</tbody>
</table>
<div class="section level4">
<h4 id="advanced-joining">Advanced joining<a class="anchor" aria-label="anchor" href="#advanced-joining"></a>
</h4>
<p>If there are multiple sources for the same series and values need to
be coalesced into a single column, both series can be loaded with the
same column name into different variables in the storage environment.
When building the series, one can be designated <code>late</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load fund NAVs, uses default "acme" for column and storage variable</span></span>
<span><span class="fu"><a href="../reference/load_fund.html">load_fund</a></span><span class="op">(</span><span class="st">"ACME"</span>,</span>
<span>          file <span class="op">=</span> <span class="st">"ACME1.xlsx"</span>,</span>
<span>          date_col <span class="op">=</span> <span class="st">"As Of"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># also load NAVs into "acme" column, but storage variable is "acme2"</span></span>
<span><span class="fu"><a href="../reference/load_fund.html">load_fund</a></span><span class="op">(</span><span class="st">"ACME"</span>,</span>
<span>          var_name <span class="op">=</span> <span class="st">"acme2"</span>,</span>
<span>          file <span class="op">=</span> <span class="st">"ACME2.xlsx"</span>,</span>
<span>          date_col <span class="op">=</span> <span class="st">"As Of"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># join "acme" and "acme2"</span></span>
<span><span class="co"># both columns will be available, named "acme.late" and "acme.early"</span></span>
<span><span class="va">series</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_all_series.html">build_all_series</a></span><span class="op">(</span>late <span class="op">=</span> <span class="st">"acme2"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># join and coalesce</span></span>
<span><span class="co"># on dates where both columns have values, prefer "acme2"</span></span>
<span><span class="va">series</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_all_series.html">build_all_series</a></span><span class="op">(</span>late <span class="op">=</span> <span class="st">"acme2"</span>,</span>
<span>                           join_precedence <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">".late"</span>, <span class="st">".early"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># as above, but instead of the default left join, perform a full join</span></span>
<span><span class="va">series</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_all_series.html">build_all_series</a></span><span class="op">(</span>late <span class="op">=</span> <span class="st">"acme2"</span>,</span>
<span>                           join_precedence <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">".late"</span>, <span class="st">".early"</span><span class="op">)</span>,</span>
<span>                           late_join <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="va"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">full_join</a></span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="vendor-specific-wrappers">Vendor-specific wrappers<a class="anchor" aria-label="anchor" href="#vendor-specific-wrappers"></a>
</h3>
<p>The following wrappers use <code><a href="../reference/load_fund.html">load_fund()</a></code> to import Excel
files provided by fund managers.</p>
<ul>
<li>
<code><a href="../reference/amun.html">amun()</a></code> (Amundi)</li>
<li>
<code><a href="../reference/hsbc.html">hsbc()</a></code> (HSBC)</li>
<li>
<code><a href="../reference/inve.html">inve()</a></code> (Invesco)</li>
<li>
<code><a href="../reference/ishs.html">ishs()</a></code> (iShares)</li>
<li>
<code><a href="../reference/spdr.html">spdr()</a></code> (SPDR)</li>
<li>
<code><a href="../reference/ubs.html">ubs()</a></code> (UBS)</li>
<li>
<code><a href="../reference/vang.html">vang()</a></code> (Vanguard)</li>
<li>
<code><a href="../reference/xtra.html">xtra()</a></code> (Xtrackers)</li>
</ul>
<p>Example usage:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/xtra.html">xtra</a></span><span class="op">(</span><span class="st">"EXUS"</span>, benchmark <span class="op">=</span> <span class="st">"WxUSA"</span>,</span>
<span>     file <span class="op">=</span> <span class="st">"HistoricalData-IE0006WW1TQ4.xlsx"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/xtra.html">xtra</a></span><span class="op">(</span><span class="st">"EXUS"</span>, benchmark <span class="op">=</span> <span class="st">"WxUSA"</span><span class="op">)</span> <span class="co"># assumes EXUS.xls[x]</span></span></code></pre></div>
<p><strong>Note:</strong> MSCI Excel downloads can be imported via
<code><a href="../reference/msci.html">msci()</a></code>. MSCI TSV files (the download format for leveraged
indices) can be read via <code><a href="../reference/read_msci_tsv.html">read_msci_tsv()</a></code>.</p>
</div>
<div class="section level3">
<h3 id="downloading-nav-histories">Downloading NAV histories<a class="anchor" aria-label="anchor" href="#downloading-nav-histories"></a>
</h3>
<p>fundsr can download Excel files from iShares and SPDR. Funds and URLs
can be set up via <code><a href="../reference/add_fund_urls.html">add_fund_urls()</a></code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/add_fund_urls.html">add_fund_urls</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    SPYY <span class="op">=</span> <span class="st">"https://www.ssga.com/ie/en_gb/institutional/library-content/products/fund-data/etfs/emea/navhist-emea-en-spyy-gy.xlsx"</span>,</span>
<span>    IUSQ <span class="op">=</span> <span class="st">"https://www.ishares.com/uk/individual/en/products/251850/ishares-msci-acwi-ucits-etf/1535604580409.ajax?fileType=xls&amp;fileName=iShares-MSCI-ACWI-UCITS-ETF-USD-Acc_fund&amp;dataType=fund"</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Downloaded files are stored in the data directory
(<code>fundsr.data_dir</code> option) as <code>SPYY.xlsx</code>, etc.
This allows for easy importing via the vendor-specific wrappers.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># do not redownload existing files (the default)</span></span>
<span><span class="fu"><a href="../reference/download_fund_data.html">download_fund_data</a></span><span class="op">(</span>redownload <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/spdr.html">spdr</a></span><span class="op">(</span><span class="st">"SPYY"</span>, benchmark <span class="op">=</span> <span class="st">"ACWI"</span><span class="op">)</span> <span class="co"># assumes SPYY.xls[x]</span></span>
<span><span class="fu"><a href="../reference/ishs.html">ishs</a></span><span class="op">(</span><span class="st">"IUSQ"</span>, benchmark <span class="op">=</span> <span class="st">"ACWI"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">series</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_all_series.html">build_all_series</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="retrieving-benchmarks-from-fund-files">Retrieving benchmarks from fund files<a class="anchor" aria-label="anchor" href="#retrieving-benchmarks-from-fund-files"></a>
</h3>
<p>Some fund managers include a benchmark return series in their Excel
downloads. fundsr can retrieve this benchmark via the
<code>retrieve_benchmark</code> parameter (supported for Invesco,
iShares, and Xtrackers).</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/ishs.html">ishs</a></span><span class="op">(</span><span class="st">"IUSQ"</span>, benchmark <span class="op">=</span> <span class="st">"ACWI"</span>, retrieve_benchmark <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><strong>Note:</strong> Benchmark series from fund files may have
missing values. If available, data files from the index provider should
be preferred.</p>
</div>
<div class="section level3">
<h3 id="using-data-loaders">Using data loaders<a class="anchor" aria-label="anchor" href="#using-data-loaders"></a>
</h3>
<p>Before joining the data frames in the storage environment,
<code><a href="../reference/build_all_series.html">build_all_series()</a></code> calls <code><a href="../reference/run_data_loaders.html">run_data_loaders()</a></code>
which invokes all registered as data loaders. Instead of directly
calling <code><a href="../reference/store_timeseries.html">store_timeseries()</a></code>, <code><a href="../reference/load_fund.html">load_fund()</a></code>, etc.,
more complex workflows should register functions as data loaders via
<code><a href="../reference/add_data_loader.html">add_data_loader()</a></code>. A script setting up funds tracking MSCI
ACWI could do the following.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/add_fund_urls.html">add_fund_urls</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    IUSQ <span class="op">=</span> <span class="st">"https://..."</span>,</span>
<span>    SPYY <span class="op">=</span> <span class="st">"https://..."</span>,</span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/download_fund_data.html">download_fund_data</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># download only missing files</span></span>
<span></span>
<span><span class="fu"><a href="../reference/add_data_loader.html">add_data_loader</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># downloaded via download_fund_data()</span></span>
<span>    <span class="fu"><a href="../reference/spdr.html">spdr</a></span><span class="op">(</span><span class="st">"SPYY"</span>, benchmark <span class="op">=</span> <span class="st">"ACWI"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="../reference/ishs.html">ishs</a></span><span class="op">(</span><span class="st">"IUSQ"</span>, benchmark <span class="op">=</span> <span class="st">"ACWI"</span>,</span>
<span>         retrieve_benchmark <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="co"># manual download</span></span>
<span>    <span class="fu"><a href="../reference/xtra.html">xtra</a></span><span class="op">(</span><span class="st">"SCWX"</span>, benchmark <span class="op">=</span> <span class="st">"ACWI"</span>,</span>
<span>         file <span class="op">=</span> <span class="st">"HistoricalData-LU2903252349.xlsx"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p><strong>Note:</strong> Data loaders calling
<code><a href="../reference/store_timeseries.html">store_timeseries()</a></code> directly should make use of the caching
mechanic and provide costly operations (file reads, downloads) as the
second (or <code>expr</code>) parameter to
<code><a href="../reference/store_timeseries.html">store_timeseries()</a></code>. This parameter will not be evaluated
when the data loader is run, unless the variable is missing from the
storage environment or a reload is requested.</p>
<p>An example data loader handling more funds and index data is shown in
the following code block.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/add_data_loader.html">add_data_loader</a></span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co">### Indices</span></span>
<span>    <span class="co"># Solactive GBS GM L&amp;M Cap</span></span>
<span>    <span class="fu"><a href="../reference/store_timeseries.html">store_timeseries</a></span><span class="op">(</span><span class="st">"gmlm"</span>, <span class="fu"><a href="../reference/read_timeseries.html">read_timeseries</a></span><span class="op">(</span><span class="st">"GMLM.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="../reference/store_timeseries.html">store_timeseries</a></span><span class="op">(</span><span class="st">"gmlm-gr"</span>, <span class="fu"><a href="../reference/read_timeseries.html">read_timeseries</a></span><span class="op">(</span><span class="st">"GMLM-GR.csv"</span><span class="op">)</span>,</span>
<span>                     fund_index_map <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>`GMLM-GR` <span class="op">=</span> <span class="st">"GMLM"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="co"># FTSE All-World</span></span>
<span>    <span class="fu"><a href="../reference/store_timeseries.html">store_timeseries</a></span><span class="op">(</span><span class="st">"ftaw"</span>, <span class="fu"><a href="../reference/read_timeseries.html">read_timeseries</a></span><span class="op">(</span><span class="st">"FTAW.csv"</span><span class="op">)</span>,</span>
<span>                     fund_index_map <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>`FTAW-GR` <span class="op">=</span> <span class="st">"FTAW"</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="co"># MSCI ACWI and ACWI IMI</span></span>
<span>    <span class="fu"><a href="../reference/msci.html">msci</a></span><span class="op">(</span>var_name <span class="op">=</span> <span class="st">"msci-nt"</span>,</span>
<span>         col_trans <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>ACWI <span class="op">=</span> <span class="st">"^ACWI Standard"</span>,</span>
<span>                       ACWI_IMI <span class="op">=</span> <span class="st">"^ACWI IMI"</span><span class="op">)</span>,</span>
<span>         file <span class="op">=</span> <span class="st">"MSCI-NT.xls"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="../reference/msci.html">msci</a></span><span class="op">(</span>var_name <span class="op">=</span> <span class="st">"msci-gr"</span>,</span>
<span>         col_trans <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>`ACWI-GR` <span class="op">=</span> <span class="st">"^ACWI Standard"</span>,</span>
<span>                       `ACWI_IMI-GR` <span class="op">=</span> <span class="st">"^ACWI IMI"</span><span class="op">)</span>,</span>
<span>         benchmarks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>`ACWI-GR` <span class="op">=</span> <span class="st">"ACWI"</span>,</span>
<span>                        `ACWI_IMI-GR` <span class="op">=</span> <span class="st">"ACWI_IMI"</span><span class="op">)</span>,</span>
<span>         file <span class="op">=</span> <span class="st">"MSCI-GR.xls"</span><span class="op">)</span></span>
<span>    <span class="co">### Funds</span></span>
<span>    <span class="co"># manual downloads</span></span>
<span>    <span class="fu"><a href="../reference/amun.html">amun</a></span><span class="op">(</span><span class="st">"WEBN"</span>, benchmark <span class="op">=</span> <span class="st">"GMLM"</span>,</span>
<span>         file <span class="op">=</span> <span class="st">"NAV History_Amundi_WEBN.xlsx"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="../reference/vang.html">vang</a></span><span class="op">(</span><span class="st">"VWCE"</span>, benchmark <span class="op">=</span> <span class="st">"FTAW"</span>,</span>
<span>         file <span class="op">=</span> <span class="st">"Vanguard FTSE All-World UCITS.xlsx"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="../reference/xtra.html">xtra</a></span><span class="op">(</span><span class="st">"SCWX"</span>, benchmark <span class="op">=</span> <span class="st">"ACWI"</span>,</span>
<span>         file <span class="op">=</span> <span class="st">"HistoricalData-LU2903252349.xlsx"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="../reference/inve.html">inve</a></span><span class="op">(</span><span class="st">"FWRA"</span>, benchmark <span class="op">=</span> <span class="st">"FTAW"</span><span class="op">)</span> <span class="co"># "FWRA.xls[x]" assumed</span></span>
<span>    <span class="co"># downloaded via download_fund_data()</span></span>
<span>    <span class="fu"><a href="../reference/spdr.html">spdr</a></span><span class="op">(</span><span class="st">"SPYY"</span>, benchmark <span class="op">=</span> <span class="st">"ACWI"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="../reference/spdr.html">spdr</a></span><span class="op">(</span><span class="st">"SPYI"</span>, benchmark <span class="op">=</span> <span class="st">"ACWI_IMI"</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="../reference/ishs.html">ishs</a></span><span class="op">(</span><span class="st">"IUSQ"</span>, benchmark <span class="op">=</span> <span class="st">"ACWI"</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<p>Call all registered data loaders and build the master series table by
joining all objects in the storage environment.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">series</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_all_series.html">build_all_series</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Only call registered loaders, without joining the objects. Returns
the storage environment (also available directly via
<code><a href="../reference/get_storage.html">get_storage()</a></code>).</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">storage</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_data_loaders.html">run_data_loaders</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Build the master table without running data loaders.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">series</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/join_env.html">join_env</a></span><span class="op">(</span><span class="va">storage</span>, by <span class="op">=</span> <span class="st">"date"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="resetting-and-reloading">Resetting and reloading<a class="anchor" aria-label="anchor" href="#resetting-and-reloading"></a>
</h2>
<p>A full reload (rerunning the registered data loaders and rebuilding
the master table) can be accomplished via
<code><a href="../reference/run_data_loaders.html">run_data_loaders()</a></code> and <code><a href="../reference/join_env.html">join_env()</a></code> or a single
call to <code><a href="../reference/build_all_series.html">build_all_series()</a></code> with the <code>reload</code>
parameter set to <code>TRUE</code>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># rerun data loaders, discard variables in storage environment</span></span>
<span><span class="va">storage</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_data_loaders.html">run_data_loaders</a></span><span class="op">(</span>reload <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># reconstruct series table</span></span>
<span><span class="va">series</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/join_env.html">join_env</a></span><span class="op">(</span><span class="va">storage</span>, by <span class="op">=</span> <span class="st">"date"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># equivalent, piped</span></span>
<span><span class="va">series</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_data_loaders.html">run_data_loaders</a></span><span class="op">(</span>reload <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="../reference/join_env.html">join_env</a></span><span class="op">(</span>by <span class="op">=</span> <span class="st">"date"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># equivalent, via build_all_series() helper</span></span>
<span><span class="va">series</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/build_all_series.html">build_all_series</a></span><span class="op">(</span>reload <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Downloaded files can be refreshed with the <code>redownload</code>
parameter.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/download_fund_data.html">download_fund_data</a></span><span class="op">(</span>redownload <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The package state can be fully reset with
<code><a href="../reference/reset_state.html">reset_state()</a></code>.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># reset everything (except fundsr.* options)</span></span>
<span><span class="fu"><a href="../reference/reset_state.html">reset_state</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>More granular resetting functions are also available.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># reset the storage environment (optionally also the fund-index map)</span></span>
<span><span class="fu"><a href="../reference/clear_storage.html">clear_storage</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/clear_storage.html">clear_storage</a></span><span class="op">(</span>clear_map <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># just the fund-index map</span></span>
<span><span class="fu"><a href="../reference/clear_fund_index_map.html">clear_fund_index_map</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># deregister all data loaders</span></span>
<span><span class="fu"><a href="../reference/clear_data_loaders.html">clear_data_loaders</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="calculating-differences">Calculating differences<a class="anchor" aria-label="anchor" href="#calculating-differences"></a>
</h2>
<p><code><a href="../reference/roll_diffs.html">roll_diffs()</a></code> calculates CAGR differences and log-return
differences from a master series table. It returns a named list with
elements <code>cagr</code> and <code>log</code> (each a data frame).
Using the constructed <code>master_series</code> table from <a href="#building-the-master-table">Building the master table</a>, the
rolling net and gross differences can be calculated with the following
calls.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_days</span> <span class="op">&lt;-</span> <span class="fl">365</span> <span class="co"># 365-day rolling window</span></span>
<span><span class="va">diffs_net</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/roll_diffs.html">roll_diffs</a></span><span class="op">(</span><span class="va">master_series</span>,</span>
<span>                        <span class="va">n_days</span>,</span>
<span>                        <span class="fu"><a href="../reference/get_fund_index_map.html">get_fund_index_map</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                        index_level <span class="op">=</span> <span class="st">"net"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Roll diffs gndb -&gt; IDX2</span></span>
<span><span class="co">#&gt; Roll diffs IDX1-GR -&gt; IDX1</span></span>
<span><span class="co">#&gt; Roll diffs IDX2-GR -&gt; IDX2</span></span>
<span><span class="co">#&gt; Roll diffs fnda -&gt; IDX1</span></span>
<span><span class="co">#&gt; Roll diffs fndb -&gt; IDX1</span></span>
<span><span class="co">#&gt; Roll diffs gnda -&gt; IDX2</span></span>
<span><span class="va">diffs_gross</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/roll_diffs.html">roll_diffs</a></span><span class="op">(</span><span class="va">master_series</span>,</span>
<span>                          <span class="va">n_days</span>,</span>
<span>                          <span class="fu"><a href="../reference/get_fund_index_map.html">get_fund_index_map</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                          index_level <span class="op">=</span> <span class="st">"gross"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Roll diffs gndb -&gt; IDX2-GR</span></span>
<span><span class="co">#&gt; Skipping IDX1-GR: self-tracking</span></span>
<span><span class="co">#&gt; Skipping IDX2-GR: self-tracking</span></span>
<span><span class="co">#&gt; Roll diffs fnda -&gt; IDX1-GR</span></span>
<span><span class="co">#&gt; Roll diffs fndb -&gt; IDX1-GR</span></span>
<span><span class="co">#&gt; Roll diffs gnda -&gt; IDX2-GR</span></span></code></pre></div>
<p>The following code performs the same calculation, avoiding repetition
and silencing <code><a href="../reference/roll_diffs.html">roll_diffs()</a></code> via the <code>messages</code>
parameter. Differences can be accessed via <code>diffs$net$cagr</code>,
<code>diffs$gross$log</code>, etc.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diffs</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>net <span class="op">=</span> <span class="st">"net"</span>, gross <span class="op">=</span> <span class="st">"gross"</span><span class="op">)</span>,</span>
<span>    <span class="op">~</span> <span class="fu"><a href="../reference/roll_diffs.html">roll_diffs</a></span><span class="op">(</span><span class="va">master_series</span>,</span>
<span>                 <span class="va">n_days</span>,</span>
<span>                 <span class="fu"><a href="../reference/get_fund_index_map.html">get_fund_index_map</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                 index_level <span class="op">=</span> <span class="va">.x</span>,</span>
<span>                 messages <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Inspect the most recent 365-day differences in basis points
(bps).</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># show last 3 rows, multiplied by 10K (=&gt; bps),</span></span>
<span><span class="co"># and rounded to 4 significant digits</span></span>
<span><span class="va">checkout</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">x</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_tail</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="op">-</span><span class="va">date</span>, <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">signif</a></span><span class="op">(</span><span class="va">.x</span> <span class="op">*</span> <span class="fl">10000</span>, digits <span class="op">=</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">checkout</span><span class="op">(</span><span class="va">diffs_gross</span><span class="op">$</span><span class="va">cagr</span><span class="op">)</span></span>
<span><span class="co">#&gt;         date   gndb IDX1-GR IDX2-GR   fnda   fndb   gnda</span></span>
<span><span class="co">#&gt; 1 2025-12-28 -118.3      NA      NA -22.56 -5.122 -1.621</span></span>
<span><span class="co">#&gt; 2 2025-12-29 -118.5      NA      NA -25.65 -5.872 -3.119</span></span>
<span><span class="co">#&gt; 3 2025-12-30 -113.3      NA      NA -28.56 -1.171 -4.020</span></span>
<span><span class="fu">checkout</span><span class="op">(</span><span class="va">diffs_net</span><span class="op">$</span><span class="va">log</span><span class="op">)</span></span>
<span><span class="co">#&gt;         date   gndb IDX1-GR IDX2-GR  fnda  fndb  gnda</span></span>
<span><span class="co">#&gt; 1 2025-12-28 -59.21   49.16    48.4 28.84 44.55 46.93</span></span>
<span><span class="co">#&gt; 2 2025-12-29 -59.28   49.16    48.4 26.04 43.87 45.58</span></span>
<span><span class="co">#&gt; 3 2025-12-30 -56.58   49.16    48.4 23.08 48.09 44.70</span></span>
<span><span class="fu">checkout</span><span class="op">(</span><span class="va">diffs</span><span class="op">$</span><span class="va">net</span><span class="op">$</span><span class="va">log</span><span class="op">)</span> <span class="co"># same</span></span>
<span><span class="co">#&gt;         date   gndb IDX1-GR IDX2-GR  fnda  fndb  gnda</span></span>
<span><span class="co">#&gt; 1 2025-12-28 -59.21   49.16    48.4 28.84 44.55 46.93</span></span>
<span><span class="co">#&gt; 2 2025-12-29 -59.28   49.16    48.4 26.04 43.87 45.58</span></span>
<span><span class="co">#&gt; 3 2025-12-30 -56.58   49.16    48.4 23.08 48.09 44.70</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plotting">Plotting<a class="anchor" aria-label="anchor" href="#plotting"></a>
</h2>
<div class="section level3">
<h3 id="setup-1">Setup<a class="anchor" aria-label="anchor" href="#setup-1"></a>
</h3>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">funds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"fnda"</span>, <span class="st">"fndb"</span>, <span class="st">"gnda"</span>, <span class="st">"gndb"</span>, <span class="st">"IDX1-GR"</span>, <span class="st">"IDX2-GR"</span><span class="op">)</span></span>
<span><span class="va">gg</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="va">toupper</span>, <span class="co"># uppercase fund names for the legend</span></span>
<span>    values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="st">"IDX1-GR"</span> <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>        <span class="st">"IDX2-GR"</span> <span class="op">=</span> <span class="st">"grey60"</span>,</span>
<span>        <span class="st">"fnda"</span> <span class="op">=</span> <span class="st">"#1bbe27"</span>,</span>
<span>        <span class="st">"fndb"</span> <span class="op">=</span> <span class="st">"#e97f02"</span>,</span>
<span>        <span class="st">"gnda"</span> <span class="op">=</span> <span class="st">"#b530b3"</span>,</span>
<span>        <span class="st">"gndb"</span> <span class="op">=</span> <span class="st">"#37598a"</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="output">Output<a class="anchor" aria-label="anchor" href="#output"></a>
</h3>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_roll_diffs.html">plot_roll_diffs</a></span><span class="op">(</span><span class="va">diffs_net</span><span class="op">$</span><span class="va">cagr</span>,</span>
<span>                funds <span class="op">=</span> <span class="va">funds</span>,</span>
<span>                n_days <span class="op">=</span> <span class="va">n_days</span>,</span>
<span>                use_log <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                bmark_type <span class="op">=</span> <span class="st">"net"</span>,</span>
<span>                gg_params <span class="op">=</span> <span class="va">gg</span><span class="op">)</span></span>
<span><span class="co">#&gt; plot_roll_diffs: 365d rolling CAGR differences vs net benchmark</span></span></code></pre></div>
<p><img src="importing-and-computing-differences_files/figure-html/plots-1.png" class="r-plt" alt="" width="98%"></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_roll_diffs.html">plot_roll_diffs</a></span><span class="op">(</span><span class="va">diffs_net</span><span class="op">$</span><span class="va">log</span>,</span>
<span>                funds <span class="op">=</span> <span class="va">funds</span>,</span>
<span>                n_days <span class="op">=</span> <span class="va">n_days</span>,</span>
<span>                use_log <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                bmark_type <span class="op">=</span> <span class="st">"net"</span>,</span>
<span>                gg_params <span class="op">=</span> <span class="va">gg</span><span class="op">)</span></span>
<span><span class="co">#&gt; plot_roll_diffs: 365d rolling log-return differences vs net benchmark</span></span></code></pre></div>
<p><img src="importing-and-computing-differences_files/figure-html/plots-2.png" class="r-plt" alt="" width="98%"></p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_roll_diffs.html">plot_roll_diffs</a></span><span class="op">(</span><span class="va">diffs_gross</span><span class="op">$</span><span class="va">cagr</span>,</span>
<span>                funds <span class="op">=</span> <span class="va">funds</span>,</span>
<span>                n_days <span class="op">=</span> <span class="va">n_days</span>,</span>
<span>                use_log <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                bmark_type <span class="op">=</span> <span class="st">"gross"</span>,</span>
<span>                gg_params <span class="op">=</span> <span class="va">gg</span><span class="op">)</span></span>
<span><span class="co">#&gt; plot_roll_diffs: 365d rolling CAGR differences vs gross benchmark</span></span></code></pre></div>
<p><img src="importing-and-computing-differences_files/figure-html/plots-3.png" class="r-plt" alt="" width="98%"></p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/plot_roll_diffs.html">plot_roll_diffs</a></span><span class="op">(</span><span class="va">diffs_gross</span><span class="op">$</span><span class="va">log</span>,</span>
<span>                funds <span class="op">=</span> <span class="va">funds</span>,</span>
<span>                n_days <span class="op">=</span> <span class="va">n_days</span>,</span>
<span>                use_log <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                bmark_type <span class="op">=</span> <span class="st">"gross"</span>,</span>
<span>                gg_params <span class="op">=</span> <span class="va">gg</span><span class="op">)</span></span>
<span><span class="co">#&gt; plot_roll_diffs: 365d rolling log-return differences vs gross benchmark</span></span></code></pre></div>
<p><img src="importing-and-computing-differences_files/figure-html/plots-4.png" class="r-plt" alt="" width="98%"></p>
<p>See <code><a href="../reference/run_plots.html">run_plots()</a></code> and the examples under
<code>scripts/examples</code> for a way to generate plots via flexible
specifications.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Stanislav Traykov.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
