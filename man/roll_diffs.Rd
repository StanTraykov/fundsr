% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/fund_calc.R
\name{roll_diffs}
\alias{roll_diffs}
\title{Compute rolling annualized tracking differences (CAGR or log-return)}
\usage{
roll_diffs(
  df,
  n_days,
  fund_index_map,
  date_col = "date",
  use_log = TRUE,
  annual_days = 365
)
}
\arguments{
\item{df}{Data frame containing the date column, fund columns, and
benchmark/index columns referenced in \code{fund_index_map}.}

\item{n_days}{Rolling lookback window in calendar days.}

\item{fund_index_map}{Named character vector mapping fund column names
to their corresponding benchmark/index column names.}

\item{date_col}{Name of the date column in \code{df}. Defaults to \code{"date"}.}

\item{use_log}{Logical; if \code{TRUE}, computes \strong{log-return tracking
differences}. If \code{FALSE}, computes \strong{CAGR tracking differences}.}

\item{annual_days}{Number of days used for annualization. Defaults to
\code{365}.}
}
\value{
A data frame like \code{df} with one additional column per fund,
named \verb{<fund>_rd}, containing the rolling tracking differences.
}
\description{
For each fund–index pair in \code{fund_index_map}, computes a rolling,
annualized tracking-difference series over a backward window of
\code{n_days}. The result is added as new columns named \verb{<fund>_rd}.
}
\details{
For each fund–index pair, the function locates a start point
\code{n_days} (or more) before each observation and computes:
\itemize{
\item \strong{log-return difference}
\deqn{ ( \ln(f_{t}/f_{t_0}) - \ln(i_{t}/i_{t_0}) ) \times
         \frac{annual\_days}{t - t_0} }
\item \strong{CAGR difference}
\deqn{ f^{annual\_days/(t - t_0)} - i^{annual\_days/(t - t_0)} }
}

where \eqn{f} and \eqn{i} are fund and index values, respectively.

The tracking difference is \code{NA} whenever the anchor point is missing,
the values are invalid (e.g., non-positive for log mode), or no past
observation lies within the required window.
}
