% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/fund_calc.R
\name{roll_diffs}
\alias{roll_diffs}
\title{Compute rolling annualized tracking difference statistics}
\usage{
roll_diffs(
  df,
  n_days,
  fund_index_map,
  date_col = "date",
  index_level = c("net", "gross"),
  annual_days = 365,
  messages = c("roll", "skip"),
  gross_suffix = "-GR"
)
}
\arguments{
\item{df}{Data frame containing a date column, fund columns, and
benchmark/index columns referenced in \code{fund_index_map}.}

\item{n_days}{Rolling lookback window in calendar days.}

\item{fund_index_map}{Named character vector mapping fund column names
to their corresponding benchmark/index base column names.}

\item{date_col}{Name of the date column in \code{df}.
Must be of class \code{Date} and sorted in ascending order.}

\item{index_level}{Which index level to use, one of \code{"net"} or \code{"gross"}.
If \code{"gross"}, \code{gross_suffix} is appended to the mapped index base name
before lookup in \code{df}.}

\item{annual_days}{Number of days used for annualization.}

\item{messages}{Character vector controlling emitted messages. Any of
\code{"roll"} (per-pair progress) and \code{"skip"} (skip reasons). Use
\code{messages = "roll"} to show only progress, \code{messages = "skip"} to show
only skip reasons, or \code{messages = character()} or \code{NULL} to silence all
messages.}

\item{gross_suffix}{Suffix appended to the mapped index base name when
\code{index_level = "gross"}.}
}
\value{
A named list with two data frames, \code{cagr} and \code{log}. Each data frame
contains \code{date_col} followed by one column per fund (named as in
\code{fund_index_map}), holding the rolling annualized tracking differences.
}
\description{
For each fundâ€“index pair in \code{fund_index_map}, computes rolling, annualized
tracking differences over a backward-looking window of \code{n_days} calendar
days. Both log-return and CAGR forms are returned.
}
\details{
For each date \eqn{t}, a target anchor threshold \eqn{t - n\_days} is formed.
The anchor date \eqn{t_0} is chosen as the \strong{last available observation at or
before} \eqn{t - n\_days} among rows where \strong{both} fund and index values are
present. Let \eqn{\Delta = t - t_0} in calendar days (\eqn{\Delta} can be
greater than \code{n_days} when data are missing around the threshold).

The annualized tracking differences are:
\itemize{
\item Log-return difference:
\deqn{
      \left[\ln\left(\frac{f_t}{f_{t_0}}\right) - \ln\left(\frac{i_t}{i_{t_0}}\right)\right]
      \times \frac{annual\_days}{\Delta}
    }
\item CAGR difference:
\deqn{
      \left(\frac{f_t}{f_{t_0}}\right)^{annual\_days/\Delta}
      - \left(\frac{i_t}{i_{t_0}}\right)^{annual\_days/\Delta}
    }
}

Values are \code{NA} when an anchor cannot be found, current-date inputs are missing,
\eqn{\Delta \le 0}, or values are invalid for the chosen formula (e.g. any
non-positive value for log returns, or non-finite / non-positive ratios for
CAGR).

Funds are skipped (optionally with a message) when the fund column is missing,
the mapped index column is missing (after applying \code{index_level} /
\code{gross_suffix}), or when \code{fund == index} (self-tracking).

Emitted messages will be visible at verbosity level >= 1 (option \code{fundsr.verbosity}).
Verbosity level >= 4 forces both message types regardless of the \code{messages} argument.
}
\seealso{
Other rolling difference functions: 
\code{\link{plot_roll_diffs}()}
}
\concept{rolling difference functions}
